<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>DocBook Transclusion</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="http://purl.org/dc/elements/1.1/" rel="schema.dc"/><meta name="dc.modified" content="2021-05-11T18:03:42Z"/><meta name="dc.created" content="2015-01-08"/><meta name="generator" content="DocBook xslTNG version 1.4.1 / 5216cef / SAXON HE 10.5"/><link href="./css/docbook.css" rel="stylesheet"/><link href="./css/docbook-screen.css" rel="stylesheet"/><link href="./css/transclude.css" rel="stylesheet"/></head><body class="home"><nav class="top"></nav><main><article id="transclusion" class="article"><header><h1>DocBook Transclusion</h1><div class="authorgroup"><div class="author"><h3><span class="first-last personname"><span class="firstname">Jirka</span> <span class="surname">Kosek</span></span></h3></div></div><p class="pubdate"><time class="pubdate" datetime="2015-01-08">08Â JanÂ 2015</time></p></header><div class="list-of-titles"><div class="lot toc"><div class="title">Table of Contents</div><ul class="toc"><li><a href="#intro"><span class="number">1<span class="sep">Â </span></span>Introduction</a></li><li><a href="#processing"><span class="number">2<span class="sep">Â </span></span>Transclusion processing</a></li><li><a href="#using-xinclude"><span class="label">Appendix<span class="sep">Â </span></span><span class="number">A<span class="sep">. </span></span>Using XInclude 1.1 features for your content</a></li><li><a href="#tutorial"><span class="label">Appendix<span class="sep">Â </span></span><span class="number">B<span class="sep">. </span></span>Special ID/IDREF processing</a></li><li><a href="#schema"><span class="label">Appendix<span class="sep">Â </span></span><span class="number">C<span class="sep">. </span></span>DocBook schema with support for transclusions</a></li><li><a href="#transclusion-processor"><span class="label">Appendix<span class="sep">Â </span></span><span class="number">D<span class="sep">. </span></span>Sample transclusion processor written in XSLT 2.0</a></li></ul></div></div><section id="intro" class="section"><header><h2><span class="number">1<span class="sep">Â </span></span>Introduction</h2></header><p>This document describes the syntax, semantics, and processing model
for the DocBook transclusion mechanism. Please be aware that this is a
working draft â€“ everything described below might change or disappear
completely. This proposal addresses the issues described in <i class="citetitle"><a href="https://docbook.org/docs/transclusion-requirements/"><a href="https://docbook.org/docs/transclusion-requirements/">Requirements
for transclusion in DocBook</a></a></i>.  The DocBook TC welcomes
feedback on this draft, especially from users and developers of
DocBook authoring and processing tools. Please direct your comments to
the DocBook mailing list by sending email to
<code class="email">docbook@lists.oasis-open.org</code>.</p><div class="admonition note"><div><div class="icon">ðŸ›ˆï¸Ž</div><div class="body"><header><div class="title">Note</div></header><div><p>Previous version of this draft proposed the new elements
<code class="tag tag-element">ref</code> and <code class="tag tag-element">def</code> for implementing
transclusions. Meanwhile DocBook TC decided that transclusions should
rely as much as possible on standard technologies. XInclude 1.1 added
new features that allow to implement transclusion features on
top of the XInclude. As a result transclusions were completely
redesigned to be layered on top of XInclude 1.1.</p><p>This resulted in a loss of some features. For example, it's no longer
possible to locally redefine text replacement (see this <a href="https://docbook.org/docs/transclusion/2011-04-20/transclusion.html#d6e65" class="link">example</a> from the April 20, 2014 draft of this document).</p></div></div></div></div><p>The following namespace bindings are used as prefixes in this document:</p><dl class="variablelist"><dt class="varlistentry"><span class="term"><code class="tag tag-prefix">trans</code></span></dt><dd><p>DocBook transclusion namespace
(<code class="uri">http://docbook.org/ns/transclusion</code>)</p></dd><dt class="varlistentry"><span class="term"><code class="tag tag-prefix">db</code></span></dt><dd><p>DocBook namespace
(<code class="uri">http://docbook.org/ns/docbook</code>)</p></dd><dt class="varlistentry"><span class="term"><code class="tag tag-prefix">xi</code></span></dt><dd><p>XInclude namespace
(<code class="uri">http://www.w3.org/2001/XInclude</code>)</p></dd><dt class="varlistentry"><span class="term"><code class="tag tag-prefix">local</code></span></dt><dd><p>XInclude namespace for copying attributes without a namespace
(<code class="uri">http://www.w3.org/2001/XInclude/local-attributes</code>)</p></dd></dl></section><section id="processing" class="section"><header><h2><span class="number">2<span class="sep">Â </span></span>Transclusion processing</h2></header><p>The processing model for transclusion is simple and cosists of the following steps:</p><ol class="orderedlist" type="1"><li><p>Normal XInclude 1.1 processing on the input document.</p></li><li><p>DocBook transclusion processing on the result to fix problems such as
  duplicate IDs and broken cross-references.</p></li><li><p>Normal processing on the resulting document using the DocBook stylesheets or equivalent tools.</p></li></ol><p>Transclusion processing is controlled by 
attributes from the <code class="uri">http://docbook.org/ns/transclusion</code>
namespace. These attributes are typically inserted into a
document by using the attribute copying feature of XInclude 1.1 <a href="#XI11" class="xref xref-bibliomixed"><span><span class="xreftitle">XI11</span></span></a>, which
is described in section <i class="citetitle"><a href="https://www.w3.org/XML/2012/08/xinclude-11/Overview.html#attribute-copying"><a href="https://www.w3.org/XML/2012/08/xinclude-11/Overview.html#attribute-copying">4.3
Attribute Copying when processing XML</a></a></i> of the XInclude 1.1 specification.</p><p>The transclusion processor copies documents node by node. For most
nodes this is an identity transformation. The few exceptions are
controlled by transclusion properties. Transclusion properties
<code class="property">suffix</code> and <code class="property">linkscope</code> are
defined for each node in the document as follows:</p><dl class="variablelist"><dt id="suffix" class="varlistentry"><span class="term">suffix</span></dt><dd><ul class="itemizedlist"><li>Defines a value to be appended to all ID values on the element
    (elements and attributes whose values should be treated as IDs are listed in the <code class="property">ID-list</code> property)</li><li>Default is an empty string</li><li>Inherited</li><li>Can be changed by the
    <code class="tag tag-attribute">trans:idfixup</code> and
    <code class="tag tag-attribute">trans:suffix</code> attributes</li></ul></dd><dt id="linkscope" class="varlistentry"><span class="term">linkscope</span></dt><dd><ul class="itemizedlist"><li>Defines how to correct
    ID references (elements and attributes whose values should be treated as ID references are
    listed in the <code class="property">IDREF-list</code> property)</li><li>Allowed values are <code>user</code>, <code>local</code>,
    <code>near</code>, and <code>global</code></li><li>Default value is <code>near</code></li><li>Inherited</li><li>Can be changed by the
    <code class="tag tag-attribute">trans:linkscope</code> attribute</li></ul></dd></dl><p>For each document type there are two properties,
<code class="property">ID-list</code> and <code class="property">IDREF-list</code>, which
control the transclusion process. The <code class="property">ID-list</code>
property defines the attributes and elements whose values should be treated as IDs.
Similarly, the  <code class="property">IDREF-list</code> property defines the attributes
and elements whose values should be treated as ID references.
These properties are defined for DocBook 5.0 in <a href="#docbook-lists-definition" class="xref xref-variablelist"><span><span class="xreftitle">Definition of ID-list and IDREF-list properties for DocBook 5.0</span></span></a>.
Transclusion processors are free to support the <code class="property">ID-list</code> and
<code class="property">IDREF-list</code> properties with other document
types, for example DocBook 4.x or TEI.</p><p>ID references identified in the <code class="property">IDREF-list</code> are corrected as follows:</p><dl class="long-terms variablelist"><dt class="varlistentry"><span class="term">When <code>linkscope=user</code></span></dt><dd><p>No adjustment is made.</p></dd><dt class="varlistentry"><span class="term">When <code>linkscope=local</code></span></dt><dd><p>The value of the <code class="property">suffix</code> property is added to every ID reference as a suffix.</p></dd><dt class="varlistentry"><span class="term">When <code>linkscope=near</code></span></dt><dd><p>Each ID reference is adjusted to point to
the closest element that has a <a href="#matching-id" class="link">matching ID</a>.</p><p>To find the closest element, the parent element of the element that contains the ID reference is searched for a matching ID, followed by that element's descendants.
If no matching ID is found, that element's parent is inspected in the same way. This continues until a match is found or the
root element is reached.</p></dd><dt class="varlistentry"><span class="term">When <code>linkscope=global</code></span></dt><dd><p>Each ID reference is adjusted to point to
the first element in document order that has a <a href="#matching-id" class="link">matching ID</a>.</p></dd></dl><p id="matching-id">A <em>matching ID</em> does not mean exact string equality
between ID and IDREF values. A matching ID means that the values of an ID and IDREF match after removing any added suffixes.</p><p>Transclusion properties can be set on any element using the following attributes:</p><dl class="long-terms variablelist"><dt id="idfixup-attribute" class="varlistentry"><span class="term"><code class="tag tag-attribute">trans:idfixup</code> attribute</span></dt><dd><dl class="variablelist"><dt class="varlistentry"><span class="term">value <code class="tag tag-attvalue">none</code></span></dt><dd><p>The <code class="property">suffix</code> property is set to an empty string.</p></dd><dt class="varlistentry"><span class="term">value <code class="tag tag-attvalue">suffix</code></span></dt><dd><p>The <code class="property">suffix</code> property is set to the concatenation
of the inherited suffix value and the value specified in the <code class="tag tag-attribute">trans:suffix</code> attribute.</p></dd><dt class="varlistentry"><span class="term">value <code class="tag tag-attvalue">auto</code></span></dt><dd><p>The <code class="property">suffix</code> property is set to a unique value
for each element.<sup id="idfixup-attribute_listitem1_variablelist1_varlistentry3_listitem1_para1_footnote1-fref" db-footnote="1" class="footnote-number"><a href="#idfixup-attribute_listitem1_variablelist1_varlistentry3_listitem1_para1_footnote1-fnote">1</a></sup></p></dd></dl></dd><dt id="suffix-attribute" class="varlistentry"><span class="term"><code class="tag tag-attribute">trans:suffix</code> attribute</span></dt><dd><p>This attribute defines the value of the <code class="property">suffix</code> property used when <code>trans:idfixup="suffix"</code>.</p><p>It's an error to use this attribute when the attribute/value pair <code>trans:idfixup="suffix"</code> is not also on the element.</p></dd><dt id="linkscope-attribute" class="varlistentry"><span class="term"><code class="tag tag-attribute">trans:linkscope</code> attribute</span></dt><dd><p>Sets the value of the <code class="property">linkscope</code> property.
  Permitted values are: <code>user</code>, <code>local</code>, <code>near</code>, and <code>global</code>.</p></dd></dl><p>During the transclusion process all attributes from the transclusion
namespace are removed from the resulting document.</p><div id="docbook-lists-definition" class="variablelist"><header><div class="title">Definition of ID-list and IDREF-list properties for DocBook 5.0</div></header><p>In DocBook 5.0, the <code class="property">ID-list</code> and <code class="property">IDREF-list</code> properties contain the attributes shown here:</p><dl class="variablelist"><dt class="varlistentry"><span class="term"><code class="property">ID-list</code></span></dt><dd><p><code class="tag tag-attribute">xml:id</code></p></dd><dt class="varlistentry"><span class="term"><code class="property">IDREF-list</code></span></dt><dd><p>
<code class="tag tag-attribute">linkend</code>,
<code class="tag tag-attribute">linkends</code>,
<code class="tag tag-attribute">otherterm</code>,
<code class="tag tag-attribute">zone</code>,
<code class="tag tag-attribute">startref</code>,
<code class="tag tag-attribute">arearefs</code>,
<code class="tag tag-attribute">targetptr</code>, and
<code class="tag tag-attribute">endterm</code>.</p><p>The <code class="tag tag-attribute">href</code> attribute in the XLink
namespace is considered a member of <code class="property">IDREF-list</code> when its value begins with <code>#</code>.</p></dd></dl></div></section><div id="using-xinclude" class="appendix"><header><h1><span class="label">Appendix<span class="sep">Â </span></span><span class="number">A<span class="sep">. </span></span>Using XInclude 1.1 features for your content</h1></header><p>The most common transclusion scenario is reuse of shared strings
(see <a href="https://docbook.org/docs/transclusion-requirements/transclusion-requirements.html#uc-1" class="link">https://docbook.org/docs/transclusion-requirements/transclusion-requirements.html#uc-1</a>). With
XInclude 1.0 this could only be done using XPointer schemes that
were not very interoperable. With XInclude 1.1, doing this is much easier.</p><p>Let's assume we have defined a set of shared strings in separate document (see <a href="#ex.1" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">A<span class="sep">.</span>1, </span><span class="xreftitle">Definitions stored in a separate document (<code class="filename">definitions.001.xml</code>)</span></span></a>).</p><div id="ex.1" class="example"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="9"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Placeholder for definitions&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>    &lt;phrase xml:id="product-version"&gt;3.14&lt;/phrase&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>    &lt;phrase xml:id="product-name"&gt;FooWiz&lt;/phrase&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>    &lt;phrase xml:id="corp-name"&gt;ACME Inc.&lt;/phrase&gt;&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>  &lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>&lt;/article&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">A<span class="sep">.</span>1<span class="sep">Â </span></span>Definitions stored in a separate document (<code class="filename">definitions.001.xml</code>)</div></header></div><p>If you transclude parts of this document as shown in <a href="#ex.2" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">A<span class="sep">.</span>2, </span><span class="xreftitle">Transclusion with duplicate IDs</span></span></a>, you will end up with duplicate IDs.
In this example, the same definition is included twice. Because the ID attributes are passed through unchanged, the ID value <q>product-name</q> occurs twice in the resulting document.</p><div id="ex.2" class="example"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="12"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  xmlns:xi="http://www.w3.org/2001/XInclude"&gt;&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;info&gt;&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>    &lt;title&gt;Transclusions demo&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;/info&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;The latest version of&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>    &lt;application&gt;&lt;xi:include href="definitions.001.xml" xpointer="product-name"/&gt;&lt;/application&gt; from&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>    &lt;xi:include href="definitions.001.xml" xpointer="corp-name"/&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>    is &lt;xi:include href="definitions.001.xml" xpointer="product-version"/&gt;.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;You can buy &lt;xi:include href="definitions.001.xml" xpointer="product-name"/&gt; in our on-line store.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>&lt;/article&gt;</code></span></span>
</pre></div><p>Result of transclusion:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="13"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;info&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>      &lt;title&gt;Transclusions demo&lt;/title&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>  &lt;/info&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;The latest version of</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>    &lt;application&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>         &lt;phrase xml:base="definitions.001.xml" xml:id="product-name"&gt;FooWiz&lt;/phrase&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>      &lt;/application&gt; from</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>    &lt;phrase xml:base="definitions.001.xml" xml:id="corp-name"&gt;ACME Inc.&lt;/phrase&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>    is &lt;phrase xml:base="definitions.001.xml" xml:id="product-version"&gt;3.14&lt;/phrase&gt;.&lt;/para&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;You can buy &lt;phrase xml:base="definitions.001.xml" xml:id="product-name"&gt;FooWiz&lt;/phrase&gt; in our on-line store.&lt;/para&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>&lt;/article&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">A<span class="sep">.</span>2<span class="sep">Â </span></span>Transclusion with duplicate IDs</div></header></div><p>XInclude 1.1 has an attribute, <code class="tag tag-attribute">set-xml-id</code>,
which can be used to change or remove the  <code class="tag tag-attribute">xml:id</code>
attribute on included content. <a href="#ex.3" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">A<span class="sep">.</span>3, </span><span class="xreftitle">Using <code class="tag tag-attribute">set-xml-id</code> to remove the top-level ID during transclusion</span></span></a> uses this attribute to avoid duplicate IDs.</p><div id="ex.3" class="example"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="12"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  xmlns:xi="http://www.w3.org/2001/XInclude"&gt;&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;info&gt;&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>    &lt;title&gt;Transclusions demo&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;/info&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;The latest version of&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>    &lt;application&gt;&lt;xi:include href="definitions.001.xml" xpointer="product-name" set-xml-id=""/&gt;&lt;/application&gt; from&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>    &lt;xi:include href="definitions.001.xml" xpointer="corp-name" set-xml-id=""/&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>    is &lt;xi:include href="definitions.001.xml" xpointer="product-version" set-xml-id=""/&gt;.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;You can buy &lt;xi:include href="definitions.001.xml" xpointer="product-name" set-xml-id=""/&gt; in our on-line store.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>&lt;/article&gt;</code></span></span>
</pre></div><p>Result of transclusion:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="13"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;info&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>      &lt;title&gt;Transclusions demo&lt;/title&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>  &lt;/info&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;The latest version of</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>    &lt;application&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>         &lt;phrase xml:base="definitions.001.xml"&gt;FooWiz&lt;/phrase&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>      &lt;/application&gt; from</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>    &lt;phrase xml:base="definitions.001.xml"&gt;ACME Inc.&lt;/phrase&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>    is &lt;phrase xml:base="definitions.001.xml"&gt;3.14&lt;/phrase&gt;.&lt;/para&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;You can buy &lt;phrase xml:base="definitions.001.xml"&gt;FooWiz&lt;/phrase&gt; in our on-line store.&lt;/para&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>&lt;/article&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">A<span class="sep">.</span>3<span class="sep">Â </span></span>Using <code class="tag tag-attribute">set-xml-id</code> to remove the top-level ID during transclusion</div></header></div><p>Another new XInclude 1.1 feature lets you override
attributes on included content. <a href="#ex.4" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">A<span class="sep">.</span>4, </span><span class="xreftitle">Overriding DocBook attributes on inclusion</span></span></a> shows how to use this feature to
override effectivity attributes. This feature works by placing attributes from a specially
defined namespace (<code class="uri">http://www.w3.org/2001/XInclude/local-attributes</code>) on
the <code class="tag tag-element">xi:include</code> element. These attributes define the values that should be
used to replace attributes of the same name, but no namespace, in the transcluded content.</p><div id="ex.4" class="example"><p>Consider section (<code class="filename">section.001.xml</code>), which is
labeled for the Linux operating system (<code>os="linux"</code>).</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="7"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;section xmlns="http://docbook.org/ns/docbook"</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>    version="5.0"</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>    os="linux"&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>    &lt;title&gt;Installation&lt;/title&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Text&lt;/para&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>&lt;/section&gt;</code></span></span>
</pre></div><p>Now we want to include this section in another document and pretend that
it's actually targeted at a BSD system.</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="8"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;article xmlns="http://docbook.org/ns/docbook"</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>    xmlns:xi="http://www.w3.org/2001/XInclude"</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>    xmlns:local="http://www.w3.org/2001/XInclude/local-attributes"</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>    version="5.0"&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Sample article&lt;/title&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;xi:include href="section.001.xml" local:os="bsd"/&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>&lt;/article&gt;</code></span></span>
</pre></div><p>The value of the <code>local:os</code> attribute replaces the value of the
<code>os</code> attribute during the XInclude process.</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="8"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Sample article&lt;/title&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;section version="5.0" os="bsd" xml:base="section.001.xml"&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      &lt;title&gt;Installation&lt;/title&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Text&lt;/para&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>   &lt;/section&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>&lt;/article&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">A<span class="sep">.</span>4<span class="sep">Â </span></span>Overriding DocBook attributes on inclusion</div></header></div></div><div id="tutorial" class="appendix"><header><h1><span class="label">Appendix<span class="sep">Â </span></span><span class="number">B<span class="sep">. </span></span>Special ID/IDREF processing</h1></header><p>Transcluded content can contain <code class="tag tag-attribute">xml:id</code> attributes. If one fragment is
transcluded more than once, then the resulting document after transclusion will
contain duplicate IDs. The same problem can occur if the same ID is used in two different
transcluded modules. To overcome this problem, IDs and ID references
can be adjusted during the transclusion process.</p><p>The <code class="tag tag-attribute">trans:idfixup</code> attribute on
the <code class="tag tag-element">xi:include</code> element determines how IDs are adjusted during transclusion.</p><p>Of course, if IDs are adjusted then all corresponding ID references also have
to be adjusted.</p><p>These adjustments are controlled by the <code class="tag tag-attribute">trans:idfixup</code> and <code class="tag tag-attribute">trans:linkscope</code> attributes.
The following examples show the effect of using those two
attributes. Each example transcludes the procedure shown in <a href="#ex.5" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>1, </span><span class="xreftitle">Module with sample procedure</span></span></a>, which
contains one internal link and one external link.</p><div id="ex.5" class="example"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="8"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;procedure xmlns="http://docbook.org/ns/docbook" xml:id="paper-insert"&gt;&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Inserting paper into printer&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;This procedure is for printer owners.&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  &#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;step xml:id="s1"&gt;&lt;para&gt;Make sure that you have paper.&lt;/para&gt;&lt;/step&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;step&gt;&lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1"/&gt;&lt;/para&gt;&lt;/step&gt;&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>&lt;/procedure&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>1<span class="sep">Â </span></span>Module with sample procedure</div></header></div><p><a href="#ex.6" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>2, </span><span class="xreftitle">Automatic ID/IDREF adjustment</span></span></a> transcludes this module twice to
show how we can deal with the duplicate ID problem.</p><div id="ex.6" class="example"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="22"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>      xmlns:trans="http://docbook.org/ns/transclude"&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      version="5.0"&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto"/&gt;&#xD;</code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;If the green led is blinking, please add missing paper using the following procedure.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto"/&gt;&#xD;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><p>Result of transclusion:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="41"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      &lt;title&gt;Buying printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>      &lt;title&gt;Quick installation guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>      &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e23"&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>         &lt;step xml:id="s1---d1e23"&gt;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e23"/&gt;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="23"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="24"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="25"><span class="ln">25</span><span class="ld"><code>      &lt;title&gt;Maintenance&lt;/title&gt;</code></span></span>
<span class="line" db-line="26"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;</code></span></span>
<span class="line" db-line="27"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;If the green led is blinking, please add missing paper using the following procedure.&lt;/para&gt;</code></span></span>
<span class="line" db-line="28"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e56"&gt;</code></span></span>
<span class="line" db-line="29"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="30"><span class="ln">30</span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="31"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="32"><span class="ln"></span><span class="ld"><code>         &lt;step xml:id="s1---d1e56"&gt;</code></span></span>
<span class="line" db-line="33"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="34"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="35"><span class="ln">35</span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="36"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e56"/&gt;</code></span></span>
<span class="line" db-line="37"><span class="ln"></span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="38"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="39"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="40"><span class="ln">40</span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="41"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>2<span class="sep">Â </span></span>Automatic ID/IDREF adjustment</div></header></div><p>Specifying <code class="tag tag-attribute">db:idfixup</code> triggers
the automatic ID/IDREF fixup. All IDs in the transcluded
modules are automatically suffixed to prevent ID collisions. Then,
IDREFs are fixed so that links point to the nearest possible
target. In <a href="#ex.6" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>2, </span><span class="xreftitle">Automatic ID/IDREF adjustment</span></span></a>, the link from step 2 to step 1 in the procedure always
points to the same instance of the procedure. However, the <q>buy</q>
link correctly points to the target in the main document.</p><p><a href="#ex.7" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>3, </span><span class="xreftitle">Global linkscope</span></span></a> uses <code class="literal">trans:linkscope="global"</code>
for the second transclusion. The result is that the link from step 2 in the second
procedure links to step 1 in the first procedure.</p><div id="ex.7" class="example"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="22"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>      xmlns:trans="http://docbook.org/ns/transclude"&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      version="5.0"&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto"/&gt;&#xD;</code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;If green led is blinking, please add paper using the following procedure.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto" trans:linkscope="global"/&gt;&#xD;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><p>Result of transclusion:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="41"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      &lt;title&gt;Buying printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>      &lt;title&gt;Quick installation guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>      &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e23"&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>         &lt;step xml:id="s1---d1e23"&gt;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e23"/&gt;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="23"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="24"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="25"><span class="ln">25</span><span class="ld"><code>      &lt;title&gt;Maintenance&lt;/title&gt;</code></span></span>
<span class="line" db-line="26"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;</code></span></span>
<span class="line" db-line="27"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;If green led is blinking, please add paper using the following procedure.&lt;/para&gt;</code></span></span>
<span class="line" db-line="28"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e56"&gt;</code></span></span>
<span class="line" db-line="29"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="30"><span class="ln">30</span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="31"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="32"><span class="ln"></span><span class="ld"><code>         &lt;step xml:id="s1---d1e56"&gt;</code></span></span>
<span class="line" db-line="33"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="34"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="35"><span class="ln">35</span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="36"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e23"/&gt;</code></span></span>
<span class="line" db-line="37"><span class="ln"></span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="38"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="39"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="40"><span class="ln">40</span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="41"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>3<span class="sep">Â </span></span>Global linkscope</div></header></div><p><a href="#ex.8" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>4, </span><span class="xreftitle">Local linkscope</span></span></a> uses <code class="literal">db:linkscope="local"</code> on
the first transclusion. This means that every link from this transclusion must
point to an ID inside the transcluded content; no external links are allowed.
Because the transcluded content does contain a link to an external ID (<q>buy</q>),
this example is broken, since the transclusion process rewrites <q>buy</q>
to be <q>buy---d1e23</q>, for which there is no corresponding target.</p><p>This method of transclusion can be useful if you are
transcluding foreign content and want to isolate its links from the rest of your document.</p><div id="ex.8" class="example"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="22"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>      xmlns:trans="http://docbook.org/ns/transclude"&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      version="5.0"&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto" trans:linkscope="local"/&gt;&#xD;</code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto"/&gt;&#xD;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><p>Result of transclusion:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="41"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      &lt;title&gt;Buying printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>      &lt;title&gt;Quick installation guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>      &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e23"&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy---d1e23"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>         &lt;step xml:id="s1---d1e23"&gt;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e23"/&gt;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="23"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="24"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="25"><span class="ln">25</span><span class="ld"><code>      &lt;title&gt;Maintenance&lt;/title&gt;</code></span></span>
<span class="line" db-line="26"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;</code></span></span>
<span class="line" db-line="27"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;</code></span></span>
<span class="line" db-line="28"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e56"&gt;</code></span></span>
<span class="line" db-line="29"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="30"><span class="ln">30</span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="31"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="32"><span class="ln"></span><span class="ld"><code>         &lt;step xml:id="s1---d1e56"&gt;</code></span></span>
<span class="line" db-line="33"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="34"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="35"><span class="ln">35</span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="36"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e56"/&gt;</code></span></span>
<span class="line" db-line="37"><span class="ln"></span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="38"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="39"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="40"><span class="ln">40</span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="41"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>4<span class="sep">Â </span></span>Local linkscope</div></header></div><p>You can manually assign the value of the suffix used in transcluded content.
<a href="#ex.9" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>5, </span><span class="xreftitle">Manually assigned suffix</span></span></a> shows how to do this.</p><div id="ex.9" class="example"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="22"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>      xmlns:trans="http://docbook.org/ns/transclude"&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      version="5.0"&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml" trans:idfixup="suffix" trans:suffix="_install-proc"/&gt;&#xD;</code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml" trans:idfixup="suffix" trans:suffix="_maintain-proc"/&gt;&#xD;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><p>Result of transclusion:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="41"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      &lt;title&gt;Buying printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>      &lt;title&gt;Quick installation guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>      &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert_install-proc"&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>         &lt;step xml:id="s1_install-proc"&gt;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1_install-proc"/&gt;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="23"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="24"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="25"><span class="ln">25</span><span class="ld"><code>      &lt;title&gt;Maintenance&lt;/title&gt;</code></span></span>
<span class="line" db-line="26"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;</code></span></span>
<span class="line" db-line="27"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;</code></span></span>
<span class="line" db-line="28"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert_maintain-proc"&gt;</code></span></span>
<span class="line" db-line="29"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="30"><span class="ln">30</span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="31"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="32"><span class="ln"></span><span class="ld"><code>         &lt;step xml:id="s1_maintain-proc"&gt;</code></span></span>
<span class="line" db-line="33"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="34"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="35"><span class="ln">35</span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="36"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1_maintain-proc"/&gt;</code></span></span>
<span class="line" db-line="37"><span class="ln"></span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="38"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="39"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="40"><span class="ln">40</span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="41"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>5<span class="sep">Â </span></span>Manually assigned suffix</div></header></div><p>By default, XInclude does not do any postprocessing.
Thus, the resulting document in <a href="#ex.10" class="xref xref-example"><span><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>6, </span><span class="xreftitle">Disabling ID fixup</span></span></a> contains duplicate IDs and is not valid.</p><div id="ex.10" class="example"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="21"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>      version="5.0"&gt;&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Carefully follow all procedures bellow.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml"/&gt;&#xD;</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;If green led is blinking, please add missing paper using the following procedure.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>    &lt;xi:include href="procedure.001.xml"/&gt;&#xD;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><p>Result of transclusion:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="41"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      &lt;title&gt;Buying printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>      &lt;title&gt;Quick installation guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>      &lt;para&gt;Carefully follow all procedures bellow.&lt;/para&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert"&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>         &lt;step xml:id="s1"&gt;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1"/&gt;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="23"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="24"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="25"><span class="ln">25</span><span class="ld"><code>      &lt;title&gt;Maintenance&lt;/title&gt;</code></span></span>
<span class="line" db-line="26"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;</code></span></span>
<span class="line" db-line="27"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;If green led is blinking, please add missing paper using the following procedure.&lt;/para&gt;</code></span></span>
<span class="line" db-line="28"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert"&gt;</code></span></span>
<span class="line" db-line="29"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="30"><span class="ln">30</span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="31"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="32"><span class="ln"></span><span class="ld"><code>         &lt;step xml:id="s1"&gt;</code></span></span>
<span class="line" db-line="33"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="34"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="35"><span class="ln">35</span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="36"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1"/&gt;</code></span></span>
<span class="line" db-line="37"><span class="ln"></span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="38"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="39"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="40"><span class="ln">40</span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="41"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>6<span class="sep">Â </span></span>Disabling ID fixup</div></header></div><div id="ex.11" class="example"><p>Suppose we have note in a separate file
(<code class="filename">note.001.xml</code>):</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="4"><pre class="language-none numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;note xmlns="http://docbook.org/ns/docbook" xml:id="note"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;Important note.&lt;/para&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>&lt;/note&gt;</code></span></span>
</pre></div><p>We transclude it into another file
(<code class="filename">procedure.002.xml</code>) assigning a suffix manually:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="13"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;procedure xmlns="http://docbook.org/ns/docbook" xml:id="paper-insert"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  xmlns:trans="http://docbook.org/ns/transclude"&gt;&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>  &lt;title&gt;Inserting paper into printer&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;para&gt;This procedure is for printer owners.&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  &#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>  &lt;step xml:id="s1"&gt;&lt;para&gt;Make sure that you have paper.&lt;/para&gt;&lt;/step&gt;&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>  &lt;step&gt;&lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1"/&gt;&lt;/para&gt;&lt;/step&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>  &lt;step&gt;&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>    &lt;xi:include href="note.001.xml" trans:idfixup="suffix" trans:suffix="_note001"/&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>  &lt;/step&gt;  &#xD;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>&lt;/procedure&gt;</code></span></span>
</pre></div><p>Then we transclude this procedure into a master document,
again with a manually specified suffix:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="17"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>      xmlns:trans="http://docbook.org/ns/transclude"&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      version="5.0"&gt;&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>    &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;&#xD;</code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>    &lt;xi:include href="procedure.002.xml" trans:idfixup="suffix" trans:suffix="_procedure002"/&gt;&#xD;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;&#xD;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><p>The result is that the ID in the transcluded note contains a chained
suffix <q>note_procedure002_note001</q>:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="30"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>  &lt;chapter xml:id="buy"&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      &lt;title&gt;Buying printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>  &lt;chapter&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>      &lt;title&gt;Maintenance&lt;/title&gt;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>      &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>      &lt;procedure xml:base="procedure.002.xml" xml:id="paper-insert_procedure002"&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>         &lt;title&gt;Inserting paper into printer&lt;/title&gt;</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>         &lt;para&gt;This procedure is for printer owners.</code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  </code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>         &lt;step xml:id="s1_procedure002"&gt;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1_procedure002"/&gt;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>            &lt;/para&gt;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;</code></span></span>
<span class="line" db-line="23"><span class="ln"></span><span class="ld"><code>         &lt;step&gt;</code></span></span>
<span class="line" db-line="24"><span class="ln"></span><span class="ld"><code>            &lt;note xml:base="note.001.xml" xml:id="note_procedure002_note001"&gt;</code></span></span>
<span class="line" db-line="25"><span class="ln">25</span><span class="ld"><code>               &lt;para&gt;Important note.&lt;/para&gt;</code></span></span>
<span class="line" db-line="26"><span class="ln"></span><span class="ld"><code>            &lt;/note&gt;</code></span></span>
<span class="line" db-line="27"><span class="ln"></span><span class="ld"><code>         &lt;/step&gt;  </code></span></span>
<span class="line" db-line="28"><span class="ln"></span><span class="ld"><code>      &lt;/procedure&gt;</code></span></span>
<span class="line" db-line="29"><span class="ln"></span><span class="ld"><code>  &lt;/chapter&gt;</code></span></span>
<span class="line" db-line="30"><span class="ln">30</span><span class="ld"><code>&lt;/book&gt;</code></span></span>
</pre></div><header><div class="title"><span class="label">Example<span class="sep">Â </span></span><span class="number">B<span class="sep">.</span>7<span class="sep">Â </span></span>Chaining suffixes</div></header></div></div><div id="schema" class="appendix"><header><h1><span class="label">Appendix<span class="sep">Â </span></span><span class="number">C<span class="sep">. </span></span>DocBook schema with support for transclusions</h1></header><p>TBD</p></div><div id="transclusion-processor" class="appendix"><header><h1><span class="label">Appendix<span class="sep">Â </span></span><span class="number">D<span class="sep">. </span></span>Sample transclusion processor written in XSLT 2.0</h1></header><p>Please note that this sample transclusion processor is not yet
feature complete. It supports only a subset of the proposal.</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="183"><pre class="language-none long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&#xD;</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="2.0"&#xD;</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>                xmlns:f="http://docbook.org/xslt/ns/extension"&#xD;</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>                xmlns:mp="http://docbook.org/xslt/ns/mode/private"&#xD;</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>                xmlns:db="http://docbook.org/ns/docbook"&#xD;</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>                xmlns:xs="http://www.w3.org/2001/XMLSchema"&#xD;</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>                xmlns:ta="http://docbook.org/ns/transclude"&#xD;</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>                xmlns:xia="http://www.w3.org/2001/XInclude/local-attributes"&#xD;</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>                exclude-result-prefixes="f mp xs ta xia"&gt;&#xD;</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>&lt;!-- Remove for production files, pretty print can harm mixed content --&gt;&#xD;</code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>&lt;xsl:output indent="yes"/&gt;&#xD;</code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code>&lt;xsl:template match="/"&gt;&#xD;</code></span></span>
<span class="line" db-line="15"><span class="ln">15</span><span class="ld"><code>  &lt;xsl:variable name="adjusted" select="f:adjust-ids(/)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code>  &lt;xsl:variable name="result" select="f:adjust-idrefs($adjusted)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>  &lt;xsl:sequence select="f:transclude-cleanup($result)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="18"><span class="ln"></span><span class="ld"><code>&lt;/xsl:template&gt;&#xD;</code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="20"><span class="ln">20</span><span class="ld"><code>&lt;!-- Separator for auto generated suffixes --&gt;&#xD;</code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>&lt;xsl:param name="psep" select="'---'"/&gt;&#xD;</code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="23"><span class="ln"></span><span class="ld"><code>&lt;!-- Function and mode for changing IDs based on provided suffix --&gt;&#xD;</code></span></span>
<span class="line" db-line="24"><span class="ln"></span><span class="ld"><code>&lt;xsl:function name="f:adjust-ids" as="node()+"&gt;&#xD;</code></span></span>
<span class="line" db-line="25"><span class="ln">25</span><span class="ld"><code>  &lt;xsl:param name="doc" as="node()+"/&gt;&#xD;</code></span></span>
<span class="line" db-line="26"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="27"><span class="ln"></span><span class="ld"><code>  &lt;xsl:apply-templates select="$doc" mode="mp:transclude"/&gt;&#xD;</code></span></span>
<span class="line" db-line="28"><span class="ln"></span><span class="ld"><code>&lt;/xsl:function&gt;&#xD;</code></span></span>
<span class="line" db-line="29"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="30"><span class="ln">30</span><span class="ld"><code>&lt;xsl:template match="node()" mode="mp:transclude"&gt;&#xD;</code></span></span>
<span class="line" db-line="31"><span class="ln"></span><span class="ld"><code>  &lt;xsl:param name="idfixup" select="'none'" tunnel="yes"/&gt;&#xD;</code></span></span>
<span class="line" db-line="32"><span class="ln"></span><span class="ld"><code>  &lt;xsl:param name="suffix" tunnel="yes"/&gt;&#xD;</code></span></span>
<span class="line" db-line="33"><span class="ln"></span><span class="ld"><code>  &lt;xsl:copy&gt;&#xD;</code></span></span>
<span class="line" db-line="34"><span class="ln"></span><span class="ld"><code>    &lt;xsl:copy-of select="@* except @xml:id"/&gt;&#xD;</code></span></span>
<span class="line" db-line="35"><span class="ln">35</span><span class="ld"><code>    &lt;xsl:if test="@xml:id"&gt;&#xD;</code></span></span>
<span class="line" db-line="36"><span class="ln"></span><span class="ld"><code>      &lt;xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="37"><span class="ln"></span><span class="ld"><code>        &lt;xsl:when test="($idfixup = 'none')"&gt;&#xD;</code></span></span>
<span class="line" db-line="38"><span class="ln"></span><span class="ld"><code>          &lt;xsl:copy-of select="@xml:id"/&gt;&#xD;</code></span></span>
<span class="line" db-line="39"><span class="ln"></span><span class="ld"><code>        &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="40"><span class="ln">40</span><span class="ld"><code>        &lt;xsl:otherwise&gt;&#xD;</code></span></span>
<span class="line" db-line="41"><span class="ln"></span><span class="ld"><code>          &lt;xsl:attribute name="xml:id" select="concat(@xml:id, $suffix)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="42"><span class="ln"></span><span class="ld"><code>        &lt;/xsl:otherwise&gt;&#xD;</code></span></span>
<span class="line" db-line="43"><span class="ln"></span><span class="ld"><code>      &lt;/xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="44"><span class="ln"></span><span class="ld"><code>    &lt;/xsl:if&gt;&#xD;</code></span></span>
<span class="line" db-line="45"><span class="ln">45</span><span class="ld"><code>    &lt;xsl:apply-templates mode="mp:transclude"/&gt;&#xD;</code></span></span>
<span class="line" db-line="46"><span class="ln"></span><span class="ld"><code>  &lt;/xsl:copy&gt;&#xD;</code></span></span>
<span class="line" db-line="47"><span class="ln"></span><span class="ld"><code>&lt;/xsl:template&gt;&#xD;</code></span></span>
<span class="line" db-line="48"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="49"><span class="ln"></span><span class="ld"><code>&lt;xsl:template match="node()[@ta:*]" mode="mp:transclude"&gt;&#xD;</code></span></span>
<span class="line" db-line="50"><span class="ln">50</span><span class="ld"><code>  &lt;xsl:param name="idfixup" select="'none'" tunnel="yes"/&gt;&#xD;</code></span></span>
<span class="line" db-line="51"><span class="ln"></span><span class="ld"><code>  &lt;xsl:param name="suffix" tunnel="yes"/&gt;&#xD;</code></span></span>
<span class="line" db-line="52"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="53"><span class="ln"></span><span class="ld"><code>  &lt;xsl:variable name="new-idfixup" select="if (@ta:idfixup) then @ta:idfixup else $idfixup"/&gt;&#xD;</code></span></span>
<span class="line" db-line="54"><span class="ln"></span><span class="ld"><code>  &lt;xsl:variable name="linkscope" select="if (@ta:linkscope) then @ta:linkscope else 'near'"/&gt;&#xD;</code></span></span>
<span class="line" db-line="55"><span class="ln">55</span><span class="ld"><code>  &lt;xsl:variable name="new-suffix"&gt;&#xD;</code></span></span>
<span class="line" db-line="56"><span class="ln"></span><span class="ld"><code>    &lt;xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="57"><span class="ln"></span><span class="ld"><code>      &lt;xsl:when test="$new-idfixup = 'auto'"&gt;&#xD;</code></span></span>
<span class="line" db-line="58"><span class="ln"></span><span class="ld"><code>        &lt;xsl:sequence select="concat($psep, generate-id(.))"/&gt;&#xD;</code></span></span>
<span class="line" db-line="59"><span class="ln"></span><span class="ld"><code>      &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="60"><span class="ln">60</span><span class="ld"><code>      &lt;xsl:when test="$new-idfixup = 'suffix'"&gt;&#xD;</code></span></span>
<span class="line" db-line="61"><span class="ln"></span><span class="ld"><code>        &lt;xsl:sequence select="concat($suffix, @ta:suffix)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="62"><span class="ln"></span><span class="ld"><code>      &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="63"><span class="ln"></span><span class="ld"><code>      &lt;xsl:otherwise&gt;&lt;/xsl:otherwise&gt;&#xD;</code></span></span>
<span class="line" db-line="64"><span class="ln"></span><span class="ld"><code>    &lt;/xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="65"><span class="ln">65</span><span class="ld"><code>  &lt;/xsl:variable&gt;&#xD;</code></span></span>
<span class="line" db-line="66"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="67"><span class="ln"></span><span class="ld"><code>  &lt;xsl:copy&gt;&#xD;</code></span></span>
<span class="line" db-line="68"><span class="ln"></span><span class="ld"><code>    &lt;xsl:copy-of select="@* except @xml:id"/&gt;&#xD;</code></span></span>
<span class="line" db-line="69"><span class="ln"></span><span class="ld"><code>    &lt;xsl:if test="@xml:id"&gt;&#xD;</code></span></span>
<span class="line" db-line="70"><span class="ln">70</span><span class="ld"><code>      &lt;xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="71"><span class="ln"></span><span class="ld"><code>        &lt;xsl:when test="($new-idfixup = 'none')"&gt;&#xD;</code></span></span>
<span class="line" db-line="72"><span class="ln"></span><span class="ld"><code>          &lt;xsl:copy-of select="@xml:id"/&gt;&#xD;</code></span></span>
<span class="line" db-line="73"><span class="ln"></span><span class="ld"><code>        &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="74"><span class="ln"></span><span class="ld"><code>        &lt;xsl:otherwise&gt;&#xD;</code></span></span>
<span class="line" db-line="75"><span class="ln">75</span><span class="ld"><code>          &lt;xsl:attribute name="xml:id" select="concat(@xml:id, $new-suffix)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="76"><span class="ln"></span><span class="ld"><code>        &lt;/xsl:otherwise&gt;&#xD;</code></span></span>
<span class="line" db-line="77"><span class="ln"></span><span class="ld"><code>      &lt;/xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="78"><span class="ln"></span><span class="ld"><code>    &lt;/xsl:if&gt;&#xD;</code></span></span>
<span class="line" db-line="79"><span class="ln"></span><span class="ld"><code>    &lt;xsl:attribute name="ta:suffix" select="$new-suffix"/&gt;&#xD;</code></span></span>
<span class="line" db-line="80"><span class="ln">80</span><span class="ld"><code>    &lt;xsl:apply-templates mode="mp:transclude"&gt;&#xD;</code></span></span>
<span class="line" db-line="81"><span class="ln"></span><span class="ld"><code>      &lt;xsl:with-param name="idfixup" select="$new-idfixup" tunnel="yes"/&gt;&#xD;</code></span></span>
<span class="line" db-line="82"><span class="ln"></span><span class="ld"><code>      &lt;xsl:with-param name="suffix" select="$new-suffix" tunnel="yes"/&gt;&#xD;</code></span></span>
<span class="line" db-line="83"><span class="ln"></span><span class="ld"><code>    &lt;/xsl:apply-templates&gt;&#xD;</code></span></span>
<span class="line" db-line="84"><span class="ln"></span><span class="ld"><code>  &lt;/xsl:copy&gt;  &#xD;</code></span></span>
<span class="line" db-line="85"><span class="ln">85</span><span class="ld"><code>&lt;/xsl:template&gt;&#xD;</code></span></span>
<span class="line" db-line="86"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="87"><span class="ln"></span><span class="ld"><code>&lt;!-- Function and mode for adjusting references to IDs --&gt;&#xD;</code></span></span>
<span class="line" db-line="88"><span class="ln"></span><span class="ld"><code>&lt;xsl:function name="f:adjust-idrefs" as="node()+"&gt;&#xD;</code></span></span>
<span class="line" db-line="89"><span class="ln"></span><span class="ld"><code>  &lt;xsl:param name="doc" as="node()+"/&gt;&#xD;</code></span></span>
<span class="line" db-line="90"><span class="ln">90</span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="91"><span class="ln"></span><span class="ld"><code>  &lt;xsl:apply-templates select="$doc" mode="mp:adjust-idrefs"/&gt;&#xD;</code></span></span>
<span class="line" db-line="92"><span class="ln"></span><span class="ld"><code>&lt;/xsl:function&gt;&#xD;</code></span></span>
<span class="line" db-line="93"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="94"><span class="ln"></span><span class="ld"><code>&lt;xsl:template match="node()|@*" mode="mp:adjust-idrefs"&gt;&#xD;</code></span></span>
<span class="line" db-line="95"><span class="ln">95</span><span class="ld"><code>  &lt;xsl:copy&gt;&#xD;</code></span></span>
<span class="line" db-line="96"><span class="ln"></span><span class="ld"><code>    &lt;xsl:apply-templates select="@* | node()" mode="mp:adjust-idrefs"/&gt;&#xD;</code></span></span>
<span class="line" db-line="97"><span class="ln"></span><span class="ld"><code>  &lt;/xsl:copy&gt;&#xD;</code></span></span>
<span class="line" db-line="98"><span class="ln"></span><span class="ld"><code>&lt;/xsl:template&gt;&#xD;</code></span></span>
<span class="line" db-line="99"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="100"><span class="ln">100</span><span class="ld"><code>&lt;!-- FIXME: add support for @linkends, @zone, @arearefs --&gt;&#xD;</code></span></span>
<span class="line" db-line="101"><span class="ln"></span><span class="ld"><code>&lt;!-- FIEMX: add support for xlink:href starting with # --&gt;&#xD;</code></span></span>
<span class="line" db-line="102"><span class="ln"></span><span class="ld"><code>&lt;xsl:template match="@linkend | @endterm | @otherterm | @startref" mode="mp:adjust-idrefs"&gt;&#xD;</code></span></span>
<span class="line" db-line="103"><span class="ln"></span><span class="ld"><code>  &lt;xsl:variable name="idref" select="."/&gt;&#xD;</code></span></span>
<span class="line" db-line="104"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="105"><span class="ln">105</span><span class="ld"><code>  &lt;xsl:variable name="annotation" select="ancestor-or-self::*[@ta:linkscope][1]"/&gt;&#xD;</code></span></span>
<span class="line" db-line="106"><span class="ln"></span><span class="ld"><code>  &lt;xsl:variable name="linkscope" select="($annotation/@ta:linkscope, 'near')[1]"/&gt;&#xD;</code></span></span>
<span class="line" db-line="107"><span class="ln"></span><span class="ld"><code>  &lt;xsl:variable name="suffix" select="$annotation/@ta:suffix"/&gt;&#xD;</code></span></span>
<span class="line" db-line="108"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="109"><span class="ln"></span><span class="ld"><code>  &lt;xsl:attribute name="{local-name(.)}"&gt;&#xD;</code></span></span>
<span class="line" db-line="110"><span class="ln">110</span><span class="ld"><code>    &lt;xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="111"><span class="ln"></span><span class="ld"><code>      &lt;xsl:when test="$linkscope = 'user'"&gt;&#xD;</code></span></span>
<span class="line" db-line="112"><span class="ln"></span><span class="ld"><code>        &lt;xsl:value-of select="$idref"/&gt;&#xD;</code></span></span>
<span class="line" db-line="113"><span class="ln"></span><span class="ld"><code>      &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="114"><span class="ln"></span><span class="ld"><code>      &lt;xsl:when test="$linkscope = 'local'"&gt;&#xD;</code></span></span>
<span class="line" db-line="115"><span class="ln">115</span><span class="ld"><code>        &lt;xsl:value-of select="concat($idref, $suffix)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="116"><span class="ln"></span><span class="ld"><code>      &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="117"><span class="ln"></span><span class="ld"><code>      &lt;xsl:when test="$linkscope = 'near'"&gt;&#xD;</code></span></span>
<span class="line" db-line="118"><span class="ln"></span><span class="ld"><code>        &lt;xsl:value-of select="f:nearest-matching-id($idref, ..)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="119"><span class="ln"></span><span class="ld"><code>      &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="120"><span class="ln">120</span><span class="ld"><code>      &lt;xsl:when test="$linkscope = 'global'"&gt;&#xD;</code></span></span>
<span class="line" db-line="121"><span class="ln"></span><span class="ld"><code>        &lt;xsl:value-of select="f:nearest-matching-id($idref, root(.))"/&gt;&#xD;</code></span></span>
<span class="line" db-line="122"><span class="ln"></span><span class="ld"><code>      &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="123"><span class="ln"></span><span class="ld"><code>    &lt;/xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="124"><span class="ln"></span><span class="ld"><code>  &lt;/xsl:attribute&gt;&#xD;</code></span></span>
<span class="line" db-line="125"><span class="ln">125</span><span class="ld"><code>&lt;/xsl:template&gt;&#xD;</code></span></span>
<span class="line" db-line="126"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="127"><span class="ln"></span><span class="ld"><code>&lt;!-- Function searches nearest matching ID in a given context --&gt;&#xD;</code></span></span>
<span class="line" db-line="128"><span class="ln"></span><span class="ld"><code>&lt;xsl:function name="f:nearest-matching-id" as="xs:string?"&gt;&#xD;</code></span></span>
<span class="line" db-line="129"><span class="ln"></span><span class="ld"><code>  &lt;xsl:param name="idref" as="xs:string"/&gt;&#xD;</code></span></span>
<span class="line" db-line="130"><span class="ln">130</span><span class="ld"><code>  &lt;xsl:param name="context" as="node()"/&gt;&#xD;</code></span></span>
<span class="line" db-line="131"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="132"><span class="ln"></span><span class="ld"><code>  &lt;!-- FIXME: key() requires document-node() rooted subtree --&gt;&#xD;</code></span></span>
<span class="line" db-line="133"><span class="ln"></span><span class="ld"><code>  &lt;!--  &lt;xsl:variable name="targets" select="key('unprefixed-id', f:unprefixed-id($idref, $context), $context)"/&gt; --&gt;&#xD;</code></span></span>
<span class="line" db-line="134"><span class="ln"></span><span class="ld"><code>  &lt;xsl:variable name="targets" select="$context//*[@xml:id][f:unprefixed-id(@xml:id, .) eq f:unprefixed-id($idref, $context)]"/&gt; &#xD;</code></span></span>
<span class="line" db-line="135"><span class="ln">135</span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="136"><span class="ln"></span><span class="ld"><code>  &lt;xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="137"><span class="ln"></span><span class="ld"><code>    &lt;xsl:when test="not($targets) and $context/.."&gt;&#xD;</code></span></span>
<span class="line" db-line="138"><span class="ln"></span><span class="ld"><code>      &lt;xsl:sequence select="f:nearest-matching-id($idref, $context/..)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="139"><span class="ln"></span><span class="ld"><code>    &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="140"><span class="ln">140</span><span class="ld"><code>    &lt;xsl:when test="$targets"&gt;&#xD;</code></span></span>
<span class="line" db-line="141"><span class="ln"></span><span class="ld"><code>      &lt;xsl:sequence select="$targets[1]/string(@xml:id)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="142"><span class="ln"></span><span class="ld"><code>    &lt;/xsl:when&gt;&#xD;</code></span></span>
<span class="line" db-line="143"><span class="ln"></span><span class="ld"><code>    &lt;xsl:otherwise&gt;&#xD;</code></span></span>
<span class="line" db-line="144"><span class="ln"></span><span class="ld"><code>      &lt;xsl:message&gt;Error: no matching ID for reference "&lt;xsl:value-of select="$idref"/&gt;" was found.&lt;/xsl:message&gt;&#xD;</code></span></span>
<span class="line" db-line="145"><span class="ln">145</span><span class="ld"><code>    &lt;/xsl:otherwise&gt;&#xD;</code></span></span>
<span class="line" db-line="146"><span class="ln"></span><span class="ld"><code>  &lt;/xsl:choose&gt;&#xD;</code></span></span>
<span class="line" db-line="147"><span class="ln"></span><span class="ld"><code>&lt;/xsl:function&gt;&#xD;</code></span></span>
<span class="line" db-line="148"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="149"><span class="ln"></span><span class="ld"><code>&lt;!-- FIXME: type annotation should be without ?, find why it is called with empty sequence --&gt;&#xD;</code></span></span>
<span class="line" db-line="150"><span class="ln">150</span><span class="ld"><code>&lt;xsl:function name="f:unprefixed-id" as="xs:string?"&gt;&#xD;</code></span></span>
<span class="line" db-line="151"><span class="ln"></span><span class="ld"><code>  &lt;xsl:param name="id" as="xs:string?"/&gt;&#xD;</code></span></span>
<span class="line" db-line="152"><span class="ln"></span><span class="ld"><code>  &lt;xsl:param name="context" as="node()"/&gt;&#xD;</code></span></span>
<span class="line" db-line="153"><span class="ln"></span><span class="ld"><code>  &#xD;</code></span></span>
<span class="line" db-line="154"><span class="ln"></span><span class="ld"><code>  &lt;xsl:variable name="suffix" select="$context/ancestor-or-self::*[@ta:suffix][1]/@ta:suffix"/&gt;&#xD;</code></span></span>
<span class="line" db-line="155"><span class="ln">155</span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="156"><span class="ln"></span><span class="ld"><code>  &lt;xsl:sequence select="if ($suffix) then substring-before($id, $suffix) else $id"/&gt;&#xD;</code></span></span>
<span class="line" db-line="157"><span class="ln"></span><span class="ld"><code>&lt;/xsl:function&gt;&#xD;</code></span></span>
<span class="line" db-line="158"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="159"><span class="ln"></span><span class="ld"><code>&lt;!--&#xD;</code></span></span>
<span class="line" db-line="160"><span class="ln">160</span><span class="ld"><code>&lt;xsl:key name="unprefixed-id" match="*[@xml:id]" use="f:unprefixed-id(@xml:id, .)"/&gt;&#xD;</code></span></span>
<span class="line" db-line="161"><span class="ln"></span><span class="ld"><code>--&gt;&#xD;</code></span></span>
<span class="line" db-line="162"><span class="ln"></span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="163"><span class="ln"></span><span class="ld"><code>&lt;!-- Function and mode for removing transclusion attributes from the final output --&gt;&#xD;</code></span></span>
<span class="line" db-line="164"><span class="ln"></span><span class="ld"><code>&lt;xsl:function name="f:transclude-cleanup" as="node()+"&gt;&#xD;</code></span></span>
<span class="line" db-line="165"><span class="ln">165</span><span class="ld"><code>  &lt;xsl:param name="doc" as="node()+"/&gt;&#xD;</code></span></span>
<span class="line" db-line="166"><span class="ln"></span><span class="ld"><code>  &#xD;</code></span></span>
<span class="line" db-line="167"><span class="ln"></span><span class="ld"><code>  &lt;xsl:apply-templates select="$doc" mode="mp:transclude-cleanup"/&gt;&#xD;</code></span></span>
<span class="line" db-line="168"><span class="ln"></span><span class="ld"><code>&lt;/xsl:function&gt;&#xD;</code></span></span>
<span class="line" db-line="169"><span class="ln"></span><span class="ld"><code>  &#xD;</code></span></span>
<span class="line" db-line="170"><span class="ln">170</span><span class="ld"><code>&lt;xsl:template match="node()" mode="mp:transclude-cleanup"&gt;&#xD;</code></span></span>
<span class="line" db-line="171"><span class="ln"></span><span class="ld"><code>  &lt;xsl:copy&gt;&#xD;</code></span></span>
<span class="line" db-line="172"><span class="ln"></span><span class="ld"><code>    &lt;xsl:apply-templates mode="mp:transclude-cleanup"/&gt;&#xD;</code></span></span>
<span class="line" db-line="173"><span class="ln"></span><span class="ld"><code>  &lt;/xsl:copy&gt;&#xD;</code></span></span>
<span class="line" db-line="174"><span class="ln"></span><span class="ld"><code>&lt;/xsl:template&gt;      &#xD;</code></span></span>
<span class="line" db-line="175"><span class="ln">175</span><span class="ld"><code>&#xD;</code></span></span>
<span class="line" db-line="176"><span class="ln"></span><span class="ld"><code>&lt;xsl:template match="*" mode="mp:transclude-cleanup" priority="10"&gt;&#xD;</code></span></span>
<span class="line" db-line="177"><span class="ln"></span><span class="ld"><code>  &lt;xsl:element name="{name()}" namespace="{namespace-uri()}"&gt;&#xD;</code></span></span>
<span class="line" db-line="178"><span class="ln"></span><span class="ld"><code>    &lt;xsl:copy-of select="@* except @ta:*"/&gt;&#xD;</code></span></span>
<span class="line" db-line="179"><span class="ln"></span><span class="ld"><code>    &lt;xsl:apply-templates mode="mp:transclude-cleanup"/&gt;&#xD;</code></span></span>
<span class="line" db-line="180"><span class="ln">180</span><span class="ld"><code>  &lt;/xsl:element&gt;&#xD;</code></span></span>
<span class="line" db-line="181"><span class="ln"></span><span class="ld"><code>&lt;/xsl:template&gt;      &#xD;</code></span></span>
<span class="line" db-line="182"><span class="ln"></span><span class="ld"><code>  &#xD;</code></span></span>
<span class="line" db-line="183"><span class="ln"></span><span class="ld"><code>&lt;/xsl:stylesheet&gt;</code></span></span>
</pre></div></div><div id="bibliography" class="bibliography"><header><h2>Bibliography</h2></header><p id="XI11" class="bibliomixed">[XI11] 
  <cite class="title">XML Inclusions (XInclude) Version 1.1</cite>.
  W3C Working Group Note.
  <time class="pubdate">21 July 2016.</time>
  <span class="bibliosource">Available at
  <a href="https://www.w3.org/TR/xinclude-11/" class="link">https://www.w3.org/TR/xinclude-11/</a></span>.</p></div></article></main><footer><div class="footnotes"><hr/><div class="footnote" id="idfixup-attribute_listitem1_variablelist1_varlistentry3_listitem1_para1_footnote1-fnote"><div class="footnote-number"><sup db-footnote="1" class="footnote-number"><a href="#idfixup-attribute_listitem1_variablelist1_varlistentry3_listitem1_para1_footnote1-fref">1</a></sup></div><div class="footnote-body"><p>For example, XSLT-based
implementations can use the <code class="function">generate-id()</code> function to
generate a unique suffix.</p></div></div></div></footer><nav class="bottom"></nav></body></html>